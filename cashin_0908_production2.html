<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>CashIn 09:08 Scheduler</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  .ok { color: #0a7; font-weight: 700; }
  .warn { color: #c60; font-weight: 700; }
  .err { color: #c00; font-weight: 800; }
  button { padding: 10px 14px; margin-right: 8px; cursor: pointer; }
  code { background:#f6f6f6; padding:2px 6px; border-radius:6px; }
</style>
</head>
<body>

<h2>CashIn Audio Scheduler (09:08)</h2>

<div>
  Target: <code id="target"></code><br>
  Now: <code id="now"></code><br>
  Status: <span id="status" class="warn">Waiting for unlock…</span><br><br>

  <button id="unlock">Unlock audio (click once)</button>
  <button id="stop">Stop</button>
</div>

<audio id="player" preload="auto"></audio>

<script>
  // ====== Schedule: 09:08:00 today (local PC clock) ======
  const target = new Date();
  target.setHours(9, 8, 0, 0);   // ✅ CHANGED TO 09:08

  document.getElementById("target").textContent = target.toString();

  const playlist = [
    "https://raw.githubusercontent.com/Kfirus/dashboard-sounds/main/Stop%20the%20charts.%20We%20just%20hit%20a%20new%20Cash-In%20high.mp3",
    "https://raw.githubusercontent.com/Kfirus/dashboard-sounds/main/This%20is%20what%20blazesoft%20looks%20like.%20Record%20Cash-In%20achieved.mp3",
    "https://raw.githubusercontent.com/Kfirus/dashboard-sounds/main/Look%20at%20that%20cash-in.%20It%E2%80%99s%20a%20(proud)%20BEAUTIFUL%20thing.%20We%E2%80%99re%20breaking%20(confident)%20records%20tha.mp3",
    "https://raw.githubusercontent.com/Kfirus/dashboard-sounds/main/AL_BELIEVE.mp3",
    "https://raw.githubusercontent.com/Kfirus/dashboard-sounds/main/Nobody%20has%20more%20players%20than%20us.%20The%20other%20brands%20A%20TOTAL%20(confident)%20disaster.%20But%20our%20numbers%20A.mp3"
  ];

  const audio = document.getElementById("player");
  const statusEl = document.getElementById("status");
  const nowEl = document.getElementById("now");

  let idx = 0;
  let timer = null;

  function setStatus(msg, cls) {
    statusEl.textContent = msg;
    statusEl.className = cls;
  }

  function tick() {
    nowEl.textContent = new Date().toString();
  }
  setInterval(tick, 500);
  tick();

  async function playIndex(i) {
    if (i >= playlist.length) {
      setStatus("Done. All files played. Stopped.", "ok");
      return;
    }
    idx = i;
    audio.src = playlist[i];
    audio.currentTime = 0;

    try {
      await audio.play();
      setStatus(`Playing ${i+1}/${playlist.length}`, "ok");
    } catch (e) {
      setStatus("Play blocked. Click Unlock audio once.", "err");
      console.error(e);
    }
  }

  audio.addEventListener("ended", () => playIndex(idx + 1));

  function scheduleRun() {
    const now = new Date();
    const ms = target.getTime() - now.getTime();

    if (ms <= 0) {
      setStatus("Target time already passed.", "warn");
      return;
    }

    setStatus(`Scheduled for 09:08. Starts in ${(ms/1000).toFixed(1)}s.`, "ok");
    timer = setTimeout(() => playIndex(0), ms);
  }

  document.getElementById("unlock").addEventListener("click", async () => {
    try {
      audio.src = playlist[0];
      audio.volume = 0.01;
      await audio.play();
      audio.pause();
      audio.currentTime = 0;
      audio.volume = 1.0;

      setStatus("Audio unlocked ✅ Waiting for 09:08.", "ok");
      scheduleRun();
    } catch (e) {
      setStatus("Unlock failed. Click again.", "err");
    }
  });

  document.getElementById("stop").addEventListener("click", () => {
    if (timer) clearTimeout(timer);
    audio.pause();
    audio.currentTime = 0;
    setStatus("Stopped.", "warn");
  });

  scheduleRun();
</script>

</body>
</html>